{"version":3,"sources":["file:///D:/Gameproject/NewProject-001/assets/script/pao.ts"],"names":["_decorator","Component","Node","Sprite","SpriteFrame","resources","Layers","Vec2","BoxCollider2D","Collider2D","PaoState","test","toolPyManeger","ToolStateManeger","ccclass","property","pao","start","node","on","EventType","MOUSE_UP","event","parent","getChildByName","console","log","destroy","addComponent","setPosition","load","_err","spriteFrame","getComponent","layer","Enum","UI_2D","update","deltaTime","TOUCH_MOVE","currentNode","pos","shit","set","getUILocation","x","y","setScale","group","TOUCH_END","nodeTouchEnd","TOUCH_CANCEL","nodeTouchCancel","nodePao","step","parentName","master","NewNode","NewPao","active"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Sprite, SpriteFrame, resources, director, Layers, Scene, UITransform, Vec3, Vec2, BoxCollider2D, Collider, Collider2D, Contact2DType, find} from 'cc';\r\nimport { PaoState } from './PaoState';\r\nimport { test } from './test';\r\nimport { toolPyManeger } from './toolPyManeger';\r\nimport { ToolStateManeger } from './ToolStateManeger';\r\nimport { workPyManeger } from './workPyManeger';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('pao')\r\nexport class pao extends Component {\r\n    @property(ToolStateManeger)\r\n    ToolStateManeger:ToolStateManeger = null;\r\n    \r\n    start() {\r\n        //TODO：需要将该点击监听独立为一个函数，被多个道具节点所调用。\r\n        this.node.on(Node.EventType.MOUSE_UP, (event) => {\r\n            //判断是否已经存在文字框，避免重复创建文字框组件;\r\n            if (this.node.parent.parent.getChildByName('infoBox')){\r\n                //TODO：当当前显示的内容为其他道具时，需要动态渲染文字框内的内容。\r\n                //TODO: 当前显示的内容为本道具时，销毁文字框。\r\n                console.log('文字框节点已存在，正在销毁')\r\n                this.node.parent.parent.getChildByName('infoBox').destroy();\r\n            }else{\r\n                console.log('Mouse down');\r\n                let node = new Node('infoBox');\r\n                node.addComponent(Sprite);\r\n                // node.getComponent(Sprite).spriteFrame = new SpriteFrame(url.raw(\"resources/game/wenzikuang\"))\r\n                node.setPosition(-500,10,0);\r\n                resources.load('wenzikuang/spriteFrame',SpriteFrame,(_err,spriteFrame)=>{\r\n                    node.getComponent(Sprite).spriteFrame = spriteFrame;\r\n                    //在cocos3x版本中，layer默认为default，node.layer = Layers.Enum.UI_2D；\r\n                    //2d摄像头可见的是UI_2D和UI_3D\r\n                    node.layer = Layers.Enum.UI_2D;\r\n                    console.log(node);\r\n                    console.log('文字框创建成功');\r\n                })\r\n                // director.getScene().addChild(node);\r\n                node.parent=this.node.parent.parent;\r\n                // this.node.addChild(node);\r\n            }\r\n          }, this);\r\n\r\n          \r\n          \r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        this.node.on(Node.EventType.TOUCH_MOVE,(event)=>{\r\n            if (this.node.parent.parent.parent.getChildByName('pao1')){\r\n                console.log('炮节点已存在，正在移动')\r\n                let currentNode = this.node.parent.parent.parent.getChildByName('pao1');\r\n        \r\n                // console.log(event.getLocationX(),event.getLocationY());\r\n                \r\n                //触摸点的世界坐标\r\n                let pos = new Vec2();\r\n                let shit = pos.set(event.getUILocation())\r\n                // let pos = new Vec3(event.touch._point['x'],event.touch._point['y'],0);\r\n                let x = shit.x - 800;\r\n                let y = shit.y - 450;\r\n                //转换为UI坐标\r\n                // pos=currentNode.parent.getComponent(UITransform).convertToNodeSpaceAR(pos);\r\n                // console.log(pos);\r\n                currentNode.setPosition(x,y,0);\r\n                // this.node.parent.parent.getChildByName('pao1').destroy();\r\n            }else{\r\n            //TODO:同时使用多个炮的时候可能会造成冲突\r\n                let node = new Node('pao1');\r\n                node.addComponent(Sprite);\r\n                resources.load('pao/spriteFrame',SpriteFrame,(_err,spriteFrame)=>{\r\n                    node.getComponent(Sprite).spriteFrame = spriteFrame;\r\n                    //在cocos3x版本中，layer默认为default，node.layer = Layers.Enum.UI_2D；\r\n                    //2d摄像头可见的是UI_2D和UI_3D\r\n                    node.layer = Layers.Enum.UI_2D;\r\n                    node.setScale(0.3,0.3,1);\r\n                    //添加碰撞组件\r\n                    node.addComponent(BoxCollider2D);\r\n                    node.getComponent(BoxCollider2D).group = 4;\r\n                    console.log(node.getComponent(BoxCollider2D))\r\n                    node.addComponent(toolPyManeger);\r\n                    node.addComponent(PaoState)\r\n                    // node.setPosition(event.touch.point.x)\r\n                    // console.log(node);\r\n                    // console.log(event.touch._point.x);\r\n                    // node.active = false;\r\n                    console.log('炮创建成功');\r\n                })\r\n                //放在战斗组，目前还没定义战斗组，所有放在顶层；\r\n                node.parent = this.node.parent.parent.parent;\r\n                // let x = event.touch._point['x'];\r\n                // let y = event.touch._point['y'];\r\n                // node.setPosition(x,y,0);\r\n            }\r\n          },this)\r\n\r\n        this.node.on(Node.EventType.TOUCH_END,this.nodeTouchEnd,this);\r\n        this.node.on(Node.EventType.TOUCH_CANCEL,this.nodeTouchCancel,this);\r\n    }\r\n\r\n    nodeTouchEnd(event) {\r\n        console.log('已松开鼠标')\r\n    }\r\n\r\n    nodeTouchCancel(event){\r\n        console.log('已取消触摸事件')\r\n        let nodePao = this.node.parent.parent.parent.getChildByName('pao1');\r\n        console.log(nodePao.getComponent(Collider2D))\r\n        let step = nodePao.getComponent(PaoState).ToolStateManeger.step;\r\n        console.log(\"step:\",step);\r\n        if(!step){\r\n            console.log('离开碰撞且取消触摸事件')\r\n            nodePao.destroy();\r\n        }else{\r\n            // nodePao.parent = find()\r\n            let parentName = nodePao.getComponent(PaoState).ToolStateManeger.master\r\n            console.log('这个node从属于',nodePao.getComponent(PaoState).ToolStateManeger.master)\r\n            console.log(nodePao.parent.getChildByName(\"left\").getChildByName(parentName))\r\n\r\n            //TODO:增加逻辑；若该组件下面挂在了一个tool了，就不允许再创建新的tool；\r\n            let NewNode = this.NewPao();\r\n            NewNode.parent = this.node.parent.parent.parent.getChildByName(\"left\").getChildByName(parentName);\r\n            NewNode.active = true;\r\n            nodePao.destroy();\r\n            // nodePao.setPosition(100,100,0)\r\n            // console.log(nodePao.parent);\r\n\r\n        }\r\n    }\r\n\r\n    NewPao(){\r\n        let node = new Node('pao');\r\n        node.addComponent(Sprite);\r\n        resources.load('pao/spriteFrame',SpriteFrame,(_err,spriteFrame)=>{\r\n            node.getComponent(Sprite).spriteFrame = spriteFrame;\r\n            //在cocos3x版本中，layer默认为default，node.layer = Layers.Enum.UI_2D；\r\n            //2d摄像头可见的是UI_2D和UI_3D\r\n            node.layer = Layers.Enum.UI_2D;\r\n            node.setScale(0.3,0.3,1);\r\n            //添加碰撞组件\r\n            // node.addComponent(BoxCollider2D);\r\n            // node.getComponent(BoxCollider2D).group = 4;\r\n            // console.log(node.getComponent(BoxCollider2D))\r\n            // node.addComponent(workPyManeger);\r\n            // node.addComponent(PaoState)\r\n            // node.setPosition(event.touch.point.x)\r\n            // console.log(node);\r\n            // console.log(event.touch._point.x);\r\n            // node.active = false;\r\n\r\n            //测试子弹发射的脚本\r\n            node.addComponent(test)\r\n            console.log('炮开始工作');\r\n        })\r\n\r\n        return node;\r\n    }\r\n}\r\n\r\n\r\n"]}