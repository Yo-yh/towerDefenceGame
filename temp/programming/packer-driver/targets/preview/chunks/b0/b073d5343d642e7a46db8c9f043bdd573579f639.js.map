{"version":3,"sources":["file:///D:/Gameproject/NewProject-001/assets/script/selectToolManeger.ts"],"names":["_decorator","Component","Node","Sprite","resources","SpriteFrame","Layers","find","Vec2","BoxCollider2D","infoManeger","PaoState","toolPyManeger","ccclass","property","selectToolManeger","start","node","on","EventType","MOUSE_UP","event","getComponent","setInfoBox","tooltype","update","deltaTime","TOUCH_MOVE","SelectToolAndMove","TOUCH_CANCEL","SelectToolAndCancel","getChildByName","toolname","console","log","currentNode","parent","pos","shit","set","getUILocation","x","y","setPosition","addComponent","selectStep","spriteFramePath","load","_err","spriteFrame","layer","Enum","UI_2D","setScale","group","selectNode","step","destroy","parentName","ToolStateManeger","master","NewNode","NewPao","active"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Sprite, resources, SpriteFrame, Layers, find, Vec2, BoxCollider2D, Collider2D } from 'cc';\r\nimport { canvas } from './canvas';\r\nimport { infoManeger } from './infoManeger';\r\nimport { PaoState } from './PaoState';\r\nimport { toolPyManeger } from './toolPyManeger';\r\nimport { ToolStateManeger } from './ToolStateManeger';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('selectToolManeger')\r\nexport class selectToolManeger extends Component {\r\n    @property\r\n    tooltype:number = 0;\r\n    @property\r\n    toolname = \"null\";\r\n\r\n    @property\r\n    selectStep:number = 0;\r\n    //0为未选中\r\n    //1为选中开始移动但与碰撞体为碰撞\r\n    //2为与碰撞体碰撞\r\n\r\n    @property\r\n    targetBlock:string;\r\n\r\n    start() {\r\n        this.node.on(Node.EventType.MOUSE_UP, (event) => {\r\n            find(\"Canvas/infobox\").getComponent(infoManeger).setInfoBox(this.tooltype)\r\n          }, this);\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        this.node.on(Node.EventType.TOUCH_MOVE,this.SelectToolAndMove,this);\r\n        this.node.on(Node.EventType.TOUCH_CANCEL,this.SelectToolAndCancel,this)\r\n    }\r\n\r\n    SelectToolAndMove(event){\r\n        if (find(\"Canvas/selectToolBox\").getChildByName(this.toolname)){\r\n            console.log('炮节点已存在，正在移动')\r\n            let currentNode = this.node.parent.parent.parent.getChildByName(this.toolname);\r\n            let pos = new Vec2();\r\n            let shit = pos.set(event.getUILocation())\r\n            let x = shit.x - 800;\r\n            let y = shit.y - 450;\r\n            //转换为UI坐标\r\n            // pos=currentNode.parent.getComponent(UITransform).convertToNodeSpaceAR(pos);\r\n            // console.log(pos);\r\n            currentNode.setPosition(x,y,0);\r\n            // this.node.parent.parent.getChildByName('pao1').destroy();\r\n        }else{\r\n            let node = new Node(this.toolname);\r\n            node.addComponent(Sprite);\r\n            this.selectStep = 1;\r\n            let spriteFramePath = 'pao/spriteFrame';\r\n            if (this.toolname == \"pao\"){\r\n                spriteFramePath = \"sanshepao/spriteFrame\"\r\n            } else if (this.toolname == \"dan\"){\r\n                spriteFramePath = \"zhuizongdan/spriteFrame\"\r\n            } else if (this.toolname == \"guangzi\" || \"jian\"){\r\n                spriteFramePath = \"guangzijian/spriteFrame\"\r\n            } else {\r\n                spriteFramePath = 'pao/spriteFrame';\r\n            }\r\n            resources.load(spriteFramePath,SpriteFrame,(_err,spriteFrame)=>{\r\n                node.getComponent(Sprite).spriteFrame = spriteFrame;\r\n                //在cocos3x版本中，layer默认为default，node.layer = Layers.Enum.UI_2D；\r\n                //2d摄像头可见的是UI_2D和UI_3D\r\n                node.layer = Layers.Enum.UI_2D;\r\n                node.setScale(0.3,0.3,1);\r\n                //添加碰撞组件\r\n                node.addComponent(BoxCollider2D);\r\n                node.getComponent(BoxCollider2D).group = 4;\r\n                console.log(node.getComponent(BoxCollider2D))\r\n                node.addComponent(toolPyManeger);\r\n                \r\n                console.log('炮创建成功');\r\n            })\r\n            node.parent = find(\"Canvas/selectToolBox\");\r\n            \r\n        }\r\n    }\r\n\r\n    SelectToolAndCancel(event){\r\n        console.log('已取消触摸事件')\r\n        let selectNode = find(\"Canvas/selectToolBox\").getChildByName(this.toolname);\r\n        \r\n        let step = this.selectStep;\r\n        console.log(\"step:\",step);\r\n        if(!(step==2)){\r\n            console.log('离开碰撞且取消触摸事件')\r\n            selectNode.destroy();\r\n        }else{\r\n            // selectNode.parent = find()\r\n            let parentName = selectNode.getComponent(PaoState).ToolStateManeger.master\r\n            console.log('这个node从属于',selectNode.getComponent(PaoState).ToolStateManeger.master)\r\n            console.log(selectNode.parent.getChildByName(\"left\").getChildByName(parentName))\r\n\r\n            //TODO:增加逻辑；若该组件下面挂在了一个tool了，就不允许再创建新的tool；\r\n            let NewNode = this.NewPao();\r\n            NewNode.parent = this.node.parent.parent.parent.getChildByName(\"left\").getChildByName(parentName);\r\n            NewNode.active = true;\r\n            selectNode.destroy();\r\n            // selectNode.setPosition(100,100,0)\r\n            // console.log(selectNode.parent);\r\n\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}