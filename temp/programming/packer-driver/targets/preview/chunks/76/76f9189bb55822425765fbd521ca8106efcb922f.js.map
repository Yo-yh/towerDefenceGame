{"version":3,"sources":["file:///D:/Gameproject/NewProject-001/assets/script/selectToolManeger.ts"],"names":["_decorator","Component","Node","Sprite","resources","SpriteFrame","Layers","find","Vec2","infoManeger","ccclass","property","selectToolManeger","start","node","on","EventType","MOUSE_UP","event","getComponent","setInfoBox","tooltype","update","deltaTime","TOUCH_MOVE","SelectToolAndMove","TOUCH_CANCEL","SelectToolAndCancel","parent","getChildByName","toolname","console","log","currentNode","pos","shit","set","getUILocation","x","y","setPosition","addComponent","load","_err","spriteFrame","layer","Enum","UI_2D","setScale","BoxCollider2D","group","toolPyManeger","PaoState"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Sprite, resources, SpriteFrame, Layers, find, Vec2 } from 'cc';\r\nimport { canvas } from './canvas';\r\nimport { infoManeger } from './infoManeger';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('selectToolManeger')\r\nexport class selectToolManeger extends Component {\r\n    @property\r\n    tooltype:number = 0;\r\n    @property\r\n    toolname = \"null\";\r\n    start() {\r\n        this.node.on(Node.EventType.MOUSE_UP, (event) => {\r\n            find(\"Canvas/infobox\").getComponent(infoManeger).setInfoBox(this.tooltype)\r\n          }, this);\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        this.node.on(Node.EventType.TOUCH_MOVE,this.SelectToolAndMove,this);\r\n        this.node.on(Node.EventType.TOUCH_CANCEL,this.SelectToolAndCancel,this)\r\n    }\r\n\r\n    SelectToolAndMove(event){\r\n        if (this.node.parent.parent.parent.getChildByName(this.toolname)){\r\n            console.log('炮节点已存在，正在移动')\r\n            let currentNode = this.node.parent.parent.parent.getChildByName(this.toolname);\r\n            let pos = new Vec2();\r\n            let shit = pos.set(event.getUILocation())\r\n            let x = shit.x - 800;\r\n            let y = shit.y - 450;\r\n            //转换为UI坐标\r\n            // pos=currentNode.parent.getComponent(UITransform).convertToNodeSpaceAR(pos);\r\n            // console.log(pos);\r\n            currentNode.setPosition(x,y,0);\r\n            // this.node.parent.parent.getChildByName('pao1').destroy();\r\n        }else{\r\n        //TODO:同时使用多个炮的时候可能会造成冲突\r\n            let node = new Node(this.toolname);\r\n            node.addComponent(Sprite);\r\n            resources.load('pao/spriteFrame',SpriteFrame,(_err,spriteFrame)=>{\r\n                node.getComponent(Sprite).spriteFrame = spriteFrame;\r\n                //在cocos3x版本中，layer默认为default，node.layer = Layers.Enum.UI_2D；\r\n                //2d摄像头可见的是UI_2D和UI_3D\r\n                node.layer = Layers.Enum.UI_2D;\r\n                node.setScale(0.3,0.3,1);\r\n                //添加碰撞组件\r\n                node.addComponent(BoxCollider2D);\r\n                node.getComponent(BoxCollider2D).group = 4;\r\n                console.log(node.getComponent(BoxCollider2D))\r\n                node.addComponent(toolPyManeger);\r\n                node.addComponent(PaoState)\r\n                // node.setPosition(event.touch.point.x)\r\n                // console.log(node);\r\n                // console.log(event.touch._point.x);\r\n                // node.active = false;\r\n                console.log('炮创建成功');\r\n            })\r\n            //放在战斗组，目前还没定义战斗组，所有放在顶层；\r\n            node.parent = this.node.parent.parent.parent;\r\n            // let x = event.touch._point['x'];\r\n            // let y = event.touch._point['y'];\r\n            // node.setPosition(x,y,0);\r\n        }\r\n    }\r\n\r\n    SelectToolAndCancel(event){\r\n\r\n    }\r\n}\r\n\r\n\r\n"]}